# Builds the Perl biolib_example library after resolving paths.
#

cmake_minimum_required(VERSION 2.6)

ENABLE_TESTING()

SET (M_NAME example)
SET (M_VERSION 1.0)
SET (INTERFACE perl_${M_NAME}.i)

IF(NOT BUILD_LIBS)
  SET (MAP_ROOT ../../../../..)
  SET (CMAKE_MODULE_PATH ${MAP_ROOT}/tools/cmake-support/modules)
ENDIF(NOT BUILD_LIBS)
# SET(CMAKE_LIBRARY_OUTPUT_DIRECTORY biolib)

FIND_PACKAGE(MapPerl)

# IF(NOT CYGWIN)
ADD_CUSTOM_COMMAND(
  TARGET ${M_MODULE}
  POST_BUILD
  COMMAND ${CMAKE_COMMAND} -E copy ${M_NAME}.pm biolib/${M_NAME}.pm
)
# ENDIF(NOT CYGWIN)

IF(APPLE)
  ADD_CUSTOM_COMMAND(
    TARGET ${M_MODULE}
    POST_BUILD
    COMMAND ${CMAKE_COMMAND} -E copy ${M_NAME}.so ${M_NAME}.dylib
  )
  INSTALL(FILES ${M_MODULE}.dylib DESTINATION ${PERL_LIB_PATH} )
ENDIF(APPLE)


ADD_TEST(TestPerlExample ${PERL_EXECUTABLE} -I../${M_NAME}/biolib ./../test/test_${M_NAME}.pl)

INSTALL(
  TARGETS ${M_MODULE}
  DESTINATION ${PERL_SLIB_PATH}
  LIBRARY DESTINATION lib${LIB_SUFFIX}
  ARCHIVE DESTINATION lib${LIB_SUFFIX}
  RUNTIME DESTINATION bin )

INSTALL(FILES ${M_MODULE}.pm DESTINATION ${PERL_LIB_PATH}/biolib )

