cmake_minimum_required(VERSION 2.6)
message("Building Ruby library ${SWIG_FLAGS}")
ENABLE_TESTING()

INCLUDE (../../../../../CMake/FindRLibs.cmake)
SET (LIBNAME affy)
SET (LIBVERSION 1.18.2)
SET (MY_MODULE biolib_ruby_${LIBNAME})
SET (PKG_SOURCE_DIR ../../../../clibs/${LIBNAME}-${LIBVERSION}/src)

SET (INTERFACE ruby_${LIBNAME}.i)
SET (SOURCES ${PKG_SOURCE_DIR}/biolib_${LIBNAME}.c 
     ${PKG_SOURCE_DIR}/rma2.c 
		)

FIND_PACKAGE(Ruby)
INCLUDE_DIRECTORIES(${RUBY_INCLUDE_PATH})
INCLUDE_DIRECTORIES(${CMAKE_CURRENT_SOURCE_DIR})
INCLUDE_DIRECTORIES(${PKG_SOURCE_DIR})
INCLUDE_DIRECTORIES(${R_INCLUDE_PATH})

FIND_PACKAGE(SWIG REQUIRED)
INCLUDE(${SWIG_USE_FILE})

SET(SWIG_FLAGS "")
# SET_SOURCE_FILES_PROPERTIES(${INTERFACE} PROPERTIES CPLUSPLUS ON)
SET_SOURCE_FILES_PROPERTIES(${INTERFACE} PROPERTIES SWIG_FLAGS "-includeall")

SWIG_ADD_MODULE(${MY_MODULE} ruby ${INTERFACE} ${SOURCES} )
SWIG_LINK_LIBRARIES(${MY_MODULE} ${RUBY_LIBRARY} ${R_LIBRARY} )

ADD_TEST(TestRubyAffy ${RUBY_EXECUTABLE} ./../test/test_${LIBNAME}.rb)

INSTALL(TARGETS ${MY_MODULE}
  LIBRARY DESTINATION ${RUBY_INCLUDE_PATH}
)

